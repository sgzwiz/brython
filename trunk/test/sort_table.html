<html>
<head>
<style>
body,td,th{font-family:sans-serif}
a.sort_link{margin-left:10px;text-decoration:none}
</style>

<script src="../py_tokenizer.js"></script>
<script src="../py_utils.js"></script>
<script src="../py_classes.js"></script>
<script src="../py_dom.js"></script>
<script src="../py2js.js"></script>

</head>
<body onLoad="brython()">
<script id="ascript" type="text/brython">
import time

t0 = time.time()

orders = {}

def sort_by_col(cell,numeric=False):
    th_elt = cell.parent
    th_id = th_elt['id']
    if th_id not in orders:
        if numeric:
            orders[th_id]='down'
        else:
            orders[th_id]='up'
    elif orders[th_id]=='up':
        orders[th_id]='down'
    else:
        orders[th_id]='up'
    ascending = orders[th_id]

    tr_elt = th_elt.parent
    rank = -1
    for child in tr_elt.children:
        if isinstance(child,TH):
            rank += 1
        if child == th_elt:
            num = rank
            break

    nb_val = 0
    tb_elt = tr_elt.parent
    lines = []
    line_nums = []
    col_values = []

    for i,row in enumerate(tb_elt.children):
        line = []
        flag = False
        if isinstance(row,TR) and row != tr_elt:
            rank = -1
            for cell in row.children:
                if isinstance(cell,TD):
                    flag = True
                    rank += 1
                    if rank==num:
                        nb_val += 1
                        val = cell.text
                        col_values.append(val)
                    line.append(cell.html)
            if flag: # only if row has TD cells : skip table header (TH)
                lines.append(line) # list of values
                line_nums.append(i) # rank in table children

    deco = []
    for i,col_value in enumerate(col_values):
        deco.append([col_value,i])
    deco1 = deco[:]

    def _first(_item):
        return _item[0]
    
    deco.sort(_first)

    if ascending == 'down':
        deco.reverse()

    was_sorted = True
    for x,y in zip(deco,deco1):
        if x!=y:
            was_sorted = False
            break

    if was_sorted:
        # table was already sorted : do nothing
        return

    new_lines = []
    for _item in deco:
        new_lines.append(lines[_item[1]])

    # replace by new lines
    rank = 0
    for line_num in line_nums:
        row = tb_elt.children[line_num]
        if isinstance(row,TR) and row != tr_elt:
            k = 0
            for cell in row.children:
                if isinstance(cell,TD):
                    cell.html = new_lines[rank][k]
                    k += 1
            rank += 1

lines = ['Allemagne','Berlin',357026,81.8,
'Autriche','Vienne',83871,8.40,
'Belgique','Bruxelles',30518,10.91,
'Bulgarie','Sofia',110944,7.50,
'Chypre','Nicosie',9251,0.80,
'Danemark','Copenhague',43098,5.56,
'Espagne','Madrid',505997,46.15,
'Estonie','Tallinn',43698,1.34,
'Finlande','Helsinki',338144,5.37,
'France','Paris',544000,65.07,
'Grèce','Athènes',131625,11.32,
'Hongrie','Budapest',93029,9.98,
'Irlande','Dublin',69797,4.48,
'Italie','Rome',301336,60.62,
'Lettonie','Riga',64589,2.22,
'Lituanie','Vilnius',62678,3.24,
'Luxembourg','Luxembourg',2586,0.51,
'Malte','La Valette',315,0.41,
'Pays-Bas','Amsterdam',41528,16.65,
'Pologne','Varsovie',312685,38.20,
'Portugal','Lisbonne',91946,10.63,
'République tchèque','Prague',78867,10.53,
'Roumanie','Bucarest',238391,21.41,
'Royaume-Uni','Londres',243820,62.43,
'Slovaquie','Bratislava',49034,5.43,
'Slovénie','Ljubljana',20273,2.05,
'Suède','Stockholm',441369,9.41]

t1 = time.time()
doc <= P('init %s' %(t1-t0)/1000)

doc <= H2("Pays d'Europe")

table = TABLE()
t = TBODY()
title = TR()
link = A('\u2191\u2193',Class="sort_link",href="#",onClick="sort_by_col(this)")
title <= TH('Pays')+TH('Capitale'+link)+TH('Superficie')+TH('Population')
t <= title
t2 = time.time()
times = []
for i in range(len(lines)/4):
    row = TR()
    for j in range(4):
        row <= TD(lines[4*i+j])
    t <= row

table <= t

#alert((t1-t0)/1000)
doc <= P('construction table %s' %(time.time()-t1)/1000)

#alert((t2-t1)/1000)
doc <= table

foot = P()+I('Ecrit en '+A('Brython',href="http://www.brython.info"))

doc <= foot

doc <= P('temps total %s' %(time.time()-t0)/1000)

</script>
</body>
</html>